
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Dashboard - DeepSeek AI Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/css/tailwind.css">
    <style>
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-healthy { background-color: #10B981; }
        .status-warning { background-color: #F59E0B; }
        .status-error { background-color: #EF4444; }
        .metric-card {
            transition: transform 0.2s;
        }
        .metric-card:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <nav class="bg-gray-800 border-b border-gray-700 px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <h1 class="text-xl font-bold">Production Dashboard</h1>
                <span class="bg-green-600 px-2 py-1 rounded text-xs">LIVE</span>
                <span id="lastUpdated" class="text-gray-400 text-sm">Last updated: --</span>
            </div>
            <div class="flex items-center space-x-4">
                <button id="autoRefreshToggle" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-sm">
                    Auto Refresh: ON
                </button>
                <button id="exportMetrics" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded text-sm">
                    Export Metrics
                </button>
                <a href="/admin-dashboard.html" class="text-gray-300 hover:text-white">Admin</a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-6 py-8">
        <!-- System Health Overview -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="metric-card bg-gray-800 rounded-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm">System Status</p>
                        <div class="flex items-center mt-1">
                            <span id="systemStatusIndicator" class="status-indicator status-healthy"></span>
                            <span id="systemStatusText" class="text-lg font-semibold">Operational</span>
                        </div>
                    </div>
                    <div class="bg-green-600 p-3 rounded-full">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
                <p id="uptime" class="text-xs text-gray-500 mt-2">Uptime: --</p>
            </div>

            <div class="metric-card bg-gray-800 rounded-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm">Response Time</p>
                        <p id="avgResponseTime" class="text-2xl font-bold">--ms</p>
                    </div>
                    <div class="bg-blue-600 p-3 rounded-full">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
                <div id="responseTimeStatus" class="flex items-center mt-2">
                    <span class="status-indicator status-healthy"></span>
                    <span class="text-xs text-gray-500">Excellent</span>
                </div>
            </div>

            <div class="metric-card bg-gray-800 rounded-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm">Memory Usage</p>
                        <p id="memoryUsage" class="text-2xl font-bold">--MB</p>
                    </div>
                    <div class="bg-purple-600 p-3 rounded-full">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                </div>
                <div class="w-full bg-gray-600 rounded-full h-2 mt-2">
                    <div id="memoryBar" class="bg-purple-600 h-2 rounded-full" style="width: 0%"></div>
                </div>
            </div>

            <div class="metric-card bg-gray-800 rounded-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm">Active Connections</p>
                        <p id="activeConnections" class="text-2xl font-bold">--</p>
                    </div>
                    <div class="bg-orange-600 p-3 rounded-full">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path>
                        </svg>
                    </div>
                </div>
                <p id="connectionTrend" class="text-xs text-gray-500 mt-2">--</p>
            </div>
        </div>

        <!-- API Performance Metrics -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">API Response Times</h3>
                <canvas id="responseTimeChart" width="400" height="200"></canvas>
            </div>
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">Request Volume</h3>
                <canvas id="requestVolumeChart" width="400" height="200"></canvas>
            </div>
        </div>

        <!-- Service Status Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">Core Services</h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <span>DeepSeek API</span>
                        <div class="flex items-center">
                            <span id="deepseekStatus" class="status-indicator status-healthy"></span>
                            <span class="text-sm text-gray-400">Healthy</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>RAG System</span>
                        <div class="flex items-center">
                            <span id="ragStatus" class="status-indicator status-healthy"></span>
                            <span class="text-sm text-gray-400">Healthy</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>WebSocket</span>
                        <div class="flex items-center">
                            <span id="websocketStatus" class="status-indicator status-healthy"></span>
                            <span class="text-sm text-gray-400">Healthy</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>Database</span>
                        <div class="flex items-center">
                            <span id="databaseStatus" class="status-indicator status-healthy"></span>
                            <span class="text-sm text-gray-400">Healthy</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">Error Rates</h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <span>4xx Errors</span>
                        <span id="error4xx" class="text-lg font-semibold text-yellow-400">--</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>5xx Errors</span>
                        <span id="error5xx" class="text-lg font-semibold text-red-400">--</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>Success Rate</span>
                        <span id="successRate" class="text-lg font-semibold text-green-400">--%</span>
                    </div>
                </div>
                <div class="mt-4">
                    <canvas id="errorRateChart" width="300" height="150"></canvas>
                </div>
            </div>

            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">Resource Usage</h3>
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between text-sm">
                            <span>CPU Usage</span>
                            <span id="cpuUsage">--%</span>
                        </div>
                        <div class="w-full bg-gray-600 rounded-full h-2 mt-1">
                            <div id="cpuBar" class="bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-sm">
                            <span>Memory</span>
                            <span id="memoryPercent">--%</span>
                        </div>
                        <div class="w-full bg-gray-600 rounded-full h-2 mt-1">
                            <div id="memoryBarDetail" class="bg-purple-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-sm">
                            <span>Disk I/O</span>
                            <span id="diskIO">-- MB/s</span>
                        </div>
                        <div class="w-full bg-gray-600 rounded-full h-2 mt-1">
                            <div id="diskBar" class="bg-green-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Real-time Logs -->
        <div class="bg-gray-800 rounded-lg p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Real-time System Logs</h3>
                <div class="flex space-x-2">
                    <select id="logLevelFilter" class="bg-gray-700 text-white px-3 py-1 rounded">
                        <option value="all">All Levels</option>
                        <option value="error">Errors</option>
                        <option value="warning">Warnings</option>
                        <option value="info">Info</option>
                    </select>
                    <button id="clearLogs" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm">
                        Clear
                    </button>
                </div>
            </div>
            <div id="logContainer" class="bg-gray-900 rounded p-4 h-64 overflow-y-auto font-mono text-sm">
                <div class="text-gray-500 text-center">Loading logs...</div>
            </div>
        </div>
    </div>

    <script>
        class ProductionDashboard {
            constructor() {
                this.charts = {};
                this.autoRefresh = true;
                this.refreshInterval = null;
                this.logs = [];
                this.metrics = {
                    responseTime: [],
                    requestVolume: [],
                    errorRates: [],
                    timestamps: []
                };
                this.init();
            }

            async init() {
                await this.loadInitialData();
                this.setupCharts();
                this.setupEventListeners();
                this.startAutoRefresh();
                this.connectWebSocket();
            }

            async loadInitialData() {
                try {
                    const [healthResponse, diagnosticsResponse] = await Promise.all([
                        fetch('/api/health'),
                        fetch('/api/diagnostics')
                    ]);

                    const healthData = await healthResponse.json();
                    const diagnosticsData = await diagnosticsResponse.json();

                    this.updateHealthMetrics(healthData, diagnosticsData);
                } catch (error) {
                    console.error('Failed to load initial data:', error);
                }
            }

            updateHealthMetrics(healthData, diagnosticsData) {
                // Update system status
                document.getElementById('systemStatusText').textContent = healthData.status || 'Unknown';
                document.getElementById('uptime').textContent = `Uptime: ${this.formatUptime(diagnosticsData.uptime)}`;
                
                // Update memory usage
                const memoryMB = parseInt(diagnosticsData.memory) || 0;
                document.getElementById('memoryUsage').textContent = `${memoryMB}MB`;
                
                // Simulate other metrics for demo
                document.getElementById('avgResponseTime').textContent = `${Math.round(Math.random() * 100 + 50)}ms`;
                document.getElementById('activeConnections').textContent = diagnosticsData.activeConnections || '0';
                
                document.getElementById('lastUpdated').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
            }

            setupCharts() {
                // Response Time Chart
                const responseTimeCtx = document.getElementById('responseTimeChart').getContext('2d');
                this.charts.responseTime = new Chart(responseTimeCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Response Time (ms)',
                            data: [],
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { labels: { color: 'white' } }
                        },
                        scales: {
                            y: {
                                ticks: { color: 'white' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            x: {
                                ticks: { color: 'white' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });

                // Request Volume Chart
                const requestVolumeCtx = document.getElementById('requestVolumeChart').getContext('2d');
                this.charts.requestVolume = new Chart(requestVolumeCtx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Requests/min',
                            data: [],
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: 'rgb(16, 185, 129)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { labels: { color: 'white' } }
                        },
                        scales: {
                            y: {
                                ticks: { color: 'white' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            x: {
                                ticks: { color: 'white' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });

                // Error Rate Chart
                const errorRateCtx = document.getElementById('errorRateChart').getContext('2d');
                this.charts.errorRate = new Chart(errorRateCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Success', '4xx Errors', '5xx Errors'],
                        datasets: [{
                            data: [95, 3, 2],
                            backgroundColor: ['#10B981', '#F59E0B', '#EF4444']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { labels: { color: 'white' } }
                        }
                    }
                });
            }

            setupEventListeners() {
                // Auto refresh toggle
                document.getElementById('autoRefreshToggle').addEventListener('click', () => {
                    this.toggleAutoRefresh();
                });

                // Export metrics
                document.getElementById('exportMetrics').addEventListener('click', () => {
                    this.exportMetrics();
                });

                // Clear logs
                document.getElementById('clearLogs').addEventListener('click', () => {
                    this.clearLogs();
                });

                // Log level filter
                document.getElementById('logLevelFilter').addEventListener('change', (e) => {
                    this.filterLogs(e.target.value);
                });
            }

            connectWebSocket() {
                try {
                    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                    const wsUrl = `${protocol}//${window.location.host}/ws`;
                    
                    this.ws = new WebSocket(wsUrl);
                    
                    this.ws.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        if (data.type === 'metrics') {
                            this.updateRealTimeMetrics(data.data);
                        } else if (data.type === 'log') {
                            this.addLogEntry(data.data);
                        }
                    };
                } catch (error) {
                    console.warn('WebSocket connection failed:', error);
                }
            }

            addLogEntry(logData) {
                const logContainer = document.getElementById('logContainer');
                const timestamp = new Date().toLocaleTimeString();
                const logElement = document.createElement('div');
                logElement.className = `log-entry ${logData.level}`;
                logElement.innerHTML = `<span class="text-gray-500">[${timestamp}]</span> <span class="text-${this.getLogColor(logData.level)}-400">${logData.level.toUpperCase()}</span>: ${logData.message}`;
                
                logContainer.appendChild(logElement);
                logContainer.scrollTop = logContainer.scrollHeight;
                
                // Keep only last 100 log entries
                const entries = logContainer.querySelectorAll('.log-entry');
                if (entries.length > 100) {
                    entries[0].remove();
                }
            }

            getLogColor(level) {
                switch (level) {
                    case 'error': return 'red';
                    case 'warning': return 'yellow';
                    case 'info': return 'blue';
                    default: return 'gray';
                }
            }

            clearLogs() {
                document.getElementById('logContainer').innerHTML = '<div class="text-gray-500 text-center">Logs cleared</div>';
            }

            filterLogs(level) {
                const entries = document.querySelectorAll('.log-entry');
                entries.forEach(entry => {
                    if (level === 'all' || entry.classList.contains(level)) {
                        entry.style.display = 'block';
                    } else {
                        entry.style.display = 'none';
                    }
                });
            }

            toggleAutoRefresh() {
                this.autoRefresh = !this.autoRefresh;
                const button = document.getElementById('autoRefreshToggle');
                button.textContent = `Auto Refresh: ${this.autoRefresh ? 'ON' : 'OFF'}`;
                
                if (this.autoRefresh) {
                    this.startAutoRefresh();
                } else {
                    this.stopAutoRefresh();
                }
            }

            startAutoRefresh() {
                if (this.refreshInterval) return;
                
                this.refreshInterval = setInterval(() => {
                    if (this.autoRefresh) {
                        this.loadInitialData();
                        this.updateCharts();
                    }
                }, 5000); // Refresh every 5 seconds
            }

            stopAutoRefresh() {
                if (this.refreshInterval) {
                    clearInterval(this.refreshInterval);
                    this.refreshInterval = null;
                }
            }

            updateCharts() {
                const now = new Date().toLocaleTimeString();
                
                // Update response time chart
                this.metrics.responseTime.push(Math.round(Math.random() * 100 + 50));
                this.metrics.timestamps.push(now);
                
                if (this.metrics.responseTime.length > 20) {
                    this.metrics.responseTime.shift();
                    this.metrics.timestamps.shift();
                }
                
                this.charts.responseTime.data.labels = this.metrics.timestamps;
                this.charts.responseTime.data.datasets[0].data = this.metrics.responseTime;
                this.charts.responseTime.update('none');
                
                // Update request volume chart
                const requestVolume = Math.round(Math.random() * 50 + 10);
                this.charts.requestVolume.data.labels.push(now);
                this.charts.requestVolume.data.datasets[0].data.push(requestVolume);
                
                if (this.charts.requestVolume.data.labels.length > 10) {
                    this.charts.requestVolume.data.labels.shift();
                    this.charts.requestVolume.data.datasets[0].data.shift();
                }
                
                this.charts.requestVolume.update('none');
            }

            exportMetrics() {
                const data = {
                    timestamp: new Date().toISOString(),
                    metrics: this.metrics,
                    systemStatus: document.getElementById('systemStatusText').textContent,
                    uptime: document.getElementById('uptime').textContent,
                    memoryUsage: document.getElementById('memoryUsage').textContent,
                    activeConnections: document.getElementById('activeConnections').textContent
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `metrics-${new Date().toISOString().slice(0, 10)}.json`;
                a.click();
                
                URL.revokeObjectURL(url);
            }

            formatUptime(seconds) {
                if (!seconds) return 'Unknown';
                
                const days = Math.floor(seconds / 86400);
                const hours = Math.floor((seconds % 86400) / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                
                if (days > 0) return `${days}d ${hours}h`;
                if (hours > 0) return `${hours}h ${minutes}m`;
                return `${Math.floor(seconds)}s`;
            }
        }

        // Initialize dashboard
        const dashboard = new ProductionDashboard();
    </script>
</body>
</html>
