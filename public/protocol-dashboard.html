<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced AI Protocol Dashboard - RAG 2.0, A2A, MCP, AG-UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .protocol-card { transition: all 0.3s ease; }
        .protocol-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .metric-value { font-family: 'Monaco', monospace; }
        .status-active { background: linear-gradient(90deg, #10b981, #059669); }
        .status-inactive { background: linear-gradient(90deg, #6b7280, #4b5563); }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                Advanced AI Protocol Dashboard
            </h1>
            <p class="text-gray-300 text-lg">Real-time monitoring of RAG 2.0, A2A, MCP, and AG-UI protocols</p>
        </div>

        <!-- Protocol Status Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- A2A Protocol Card -->
            <div class="protocol-card bg-gray-800 rounded-lg p-6 border border-gray-700">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-blue-400">A2A Protocol</h3>
                    <div id="a2a-status" class="status-active px-3 py-1 rounded-full text-xs font-bold">ACTIVE</div>
                </div>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Agents:</span>
                        <span id="a2a-agents" class="metric-value text-green-400">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Tasks:</span>
                        <span id="a2a-tasks" class="metric-value text-yellow-400">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Messages:</span>
                        <span id="a2a-messages" class="metric-value text-purple-400">0</span>
                    </div>
                </div>
            </div>

            <!-- MCP Protocol Card -->
            <div class="protocol-card bg-gray-800 rounded-lg p-6 border border-gray-700">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-green-400">MCP Protocol</h3>
                    <div id="mcp-status" class="status-active px-3 py-1 rounded-full text-xs font-bold">ACTIVE</div>
                </div>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Servers:</span>
                        <span id="mcp-servers" class="metric-value text-green-400">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Tools:</span>
                        <span id="mcp-tools" class="metric-value text-yellow-400">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Resources:</span>
                        <span id="mcp-resources" class="metric-value text-purple-400">0</span>
                    </div>
                </div>
            </div>

            <!-- AG-UI Protocol Card -->
            <div class="protocol-card bg-gray-800 rounded-lg p-6 border border-gray-700">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-yellow-400">AG-UI Protocol</h3>
                    <div id="agui-status" class="status-active px-3 py-1 rounded-full text-xs font-bold">ACTIVE</div>
                </div>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Sessions:</span>
                        <span id="agui-sessions" class="metric-value text-green-400">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Runs:</span>
                        <span id="agui-runs" class="metric-value text-yellow-400">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Events:</span>
                        <span id="agui-events" class="metric-value text-purple-400">0</span>
                    </div>
                </div>
            </div>

            <!-- RAG 2.0 System Card -->
            <div class="protocol-card bg-gray-800 rounded-lg p-6 border border-gray-700">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-purple-400">RAG 2.0</h3>
                    <div id="rag-status" class="status-active px-3 py-1 rounded-full text-xs font-bold">ACTIVE</div>
                </div>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Documents:</span>
                        <span id="rag-documents" class="metric-value text-green-400">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Platforms:</span>
                        <span id="rag-platforms" class="metric-value text-yellow-400">5</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Queries:</span>
                        <span id="rag-queries" class="metric-value text-purple-400">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- DeepSeek Integration Status -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-8">
            <h3 class="text-2xl font-semibold mb-4 text-center">DeepSeek Reasoner Integration</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div id="deepseek-status" class="status-active px-4 py-2 rounded-lg font-bold mb-2">CONNECTED</div>
                    <p class="text-gray-400">API Status</p>
                </div>
                <div class="text-center">
                    <div id="deepseek-requests" class="text-3xl font-bold text-blue-400 mb-2">0</div>
                    <p class="text-gray-400">Total Requests</p>
                </div>
                <div class="text-center">
                    <div id="deepseek-tokens" class="text-3xl font-bold text-green-400 mb-2">0</div>
                    <p class="text-gray-400">Tokens Processed</p>
                </div>
            </div>
        </div>

        <!-- Real-time Event Log -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold">Real-time Protocol Events</h3>
                <button id="clear-logs" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded text-sm font-medium">
                    Clear Logs
                </button>
            </div>
            <div id="event-log" class="bg-gray-900 rounded p-4 h-64 overflow-y-auto font-mono text-sm">
                <div class="text-gray-500">Waiting for protocol events...</div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="mt-8 text-center">
            <div class="space-x-4">
                <a href="/" class="inline-block px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium transition-colors">
                    Main Dashboard
                </a>
                <a href="/docs.html" class="inline-block px-6 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-medium transition-colors">
                    Documentation
                </a>
                <a href="/rag-database.html" class="inline-block px-6 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-medium transition-colors">
                    RAG Database
                </a>
            </div>
        </div>
    </div>

    <script>
        class ProtocolDashboard {
            constructor() {
                this.eventLog = document.getElementById('event-log');
                this.maxLogEntries = 100;
                this.metrics = {
                    a2a: { agents: 0, tasks: 0, messages: 0 },
                    mcp: { servers: 0, tools: 0, resources: 0 },
                    agui: { sessions: 0, runs: 0, events: 0 },
                    rag: { documents: 0, platforms: 5, queries: 0 },
                    deepseek: { requests: 0, tokens: 0 }
                };
                
                this.connectWebSocket();
                this.loadMetrics();
                this.setupEventHandlers();
                
                // Update metrics every 5 seconds
                setInterval(() => this.loadMetrics(), 5000);
            }

            connectWebSocket() {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//${window.location.host}/ws`;
                
                this.ws = new WebSocket(wsUrl);
                
                this.ws.onopen = () => {
                    this.logEvent('WebSocket', 'Connected to protocol event stream', 'success');
                };
                
                this.ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        this.handleWebSocketMessage(data);
                    } catch (error) {
                        console.error('WebSocket message parse error:', error);
                    }
                };
                
                this.ws.onclose = () => {
                    this.logEvent('WebSocket', 'Connection closed, attempting reconnect...', 'warning');
                    setTimeout(() => this.connectWebSocket(), 3000);
                };
                
                this.ws.onerror = (error) => {
                    this.logEvent('WebSocket', 'Connection error', 'error');
                };
            }

            handleWebSocketMessage(data) {
                switch (data.type) {
                    case 'a2a_event':
                        this.logEvent('A2A', `${data.event.type}: ${data.event.message}`, 'info');
                        break;
                    case 'mcp_event':
                        this.logEvent('MCP', `${data.event.type}: ${data.event.message}`, 'info');
                        break;
                    case 'ag_ui_event':
                        this.logEvent('AG-UI', `${data.event.type}: Session ${data.event.sessionId}`, 'info');
                        break;
                    case 'rag_query':
                        this.metrics.rag.queries++;
                        this.updateMetricDisplay('rag-queries', this.metrics.rag.queries);
                        this.logEvent('RAG 2.0', `Query processed: ${data.query}`, 'success');
                        break;
                    case 'deepseek_request':
                        this.metrics.deepseek.requests++;
                        this.metrics.deepseek.tokens += data.tokens || 0;
                        this.updateMetricDisplay('deepseek-requests', this.metrics.deepseek.requests);
                        this.updateMetricDisplay('deepseek-tokens', this.metrics.deepseek.tokens);
                        this.logEvent('DeepSeek', `API request completed: ${data.tokens || 0} tokens`, 'success');
                        break;
                }
            }

            async loadMetrics() {
                try {
                    const response = await fetch('/api/protocol-metrics');
                    const data = await response.json();
                    
                    if (data.a2a) {
                        this.metrics.a2a = data.a2a;
                        this.updateMetricDisplay('a2a-agents', data.a2a.agents?.active || 0);
                        this.updateMetricDisplay('a2a-tasks', data.a2a.tasks?.active || 0);
                        this.updateMetricDisplay('a2a-messages', data.a2a.messages || 0);
                    }
                    
                    if (data.mcp) {
                        this.metrics.mcp = data.mcp;
                        this.updateMetricDisplay('mcp-servers', data.mcp.servers?.active || 0);
                        this.updateMetricDisplay('mcp-tools', data.mcp.tools?.total || 0);
                        this.updateMetricDisplay('mcp-resources', data.mcp.resources?.total || 0);
                    }
                    
                    if (data.agui) {
                        this.metrics.agui = data.agui;
                        this.updateMetricDisplay('agui-sessions', data.agui.sessions?.active || 0);
                        this.updateMetricDisplay('agui-runs', data.agui.runs?.active || 0);
                        this.updateMetricDisplay('agui-events', data.agui.events?.totalSent || 0);
                    }
                    
                    if (data.rag) {
                        this.metrics.rag = data.rag;
                        this.updateMetricDisplay('rag-documents', data.rag.totalDocuments || 0);
                    }
                    
                } catch (error) {
                    console.error('Failed to load metrics:', error);
                }
            }

            updateMetricDisplay(elementId, value) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = typeof value === 'number' ? value.toLocaleString() : value;
                }
            }

            logEvent(protocol, message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const colorClass = {
                    'success': 'text-green-400',
                    'warning': 'text-yellow-400',
                    'error': 'text-red-400',
                    'info': 'text-blue-400'
                }[type] || 'text-gray-400';
                
                const logEntry = document.createElement('div');
                logEntry.className = 'mb-1';
                logEntry.innerHTML = `
                    <span class="text-gray-500">[${timestamp}]</span>
                    <span class="${colorClass}">${protocol}:</span>
                    <span class="text-gray-300">${message}</span>
                `;
                
                this.eventLog.insertBefore(logEntry, this.eventLog.firstChild);
                
                // Remove old entries
                while (this.eventLog.children.length > this.maxLogEntries) {
                    this.eventLog.removeChild(this.eventLog.lastChild);
                }
            }

            setupEventHandlers() {
                document.getElementById('clear-logs').addEventListener('click', () => {
                    this.eventLog.innerHTML = '<div class="text-gray-500">Event log cleared...</div>';
                });
            }
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new ProtocolDashboard();
        });
    </script>
</body>
</html>